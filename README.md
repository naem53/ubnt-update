# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ Ubiquiti / Unifi –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä–∞–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

---
<a id="–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ"></a>
## üìë –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
- üìò [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
- ‚öôÔ∏è [–í–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏](#–≤–∞—Ä–∏–∞–Ω—Ç—ã-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- üß∞ [–ß—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ](#—á—Ç–æ-–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ)
- üè† [–°–ø–æ—Å–æ–± 1 ‚Äî –ë–µ–∑ VPS, —Å —Ç—É–Ω–Ω–µ–ª–µ–º](#—Å–ø–æ—Å–æ–±-1--–±–µ–∑-vps-—Å-—Ç—É–Ω–Ω–µ–ª–µ–º)
- ‚òÅÔ∏è [–°–ø–æ—Å–æ–± 2 ‚Äî –° VPS](#—Å–ø–æ—Å–æ–±-2--—Å-vps)
- üõ†Ô∏è [–ù–∞—Å—Ç—Ä–æ–π–∫–∏](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
  - üåç [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-dns)
  - üß± [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-nginx)
  - üîß [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ stream](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏-stream)
  - üìÇ [–í—ã–±–æ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–ª—è stream](#–≤—ã–±–æ—Ä-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ-—Ñ–∞–π–ª–∞-–¥–ª—è-stream)
- üñ•Ô∏è [–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Network Application](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∏-–≤-network-application)
  - üõ∞Ô∏è [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—É–Ω–Ω–µ–ª—è —á–µ—Ä–µ–∑ Policy Engine –≤ –º–µ–Ω—é Policy Table](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—Ç—É–Ω–Ω–µ–ª—è-—á–µ—Ä–µ–∑-policy-engine-–≤-–º–µ–Ω—é-policy-table)
  - üßæ [–î–æ–±–∞–≤–ª–µ–Ω–∏–µ DNS –∑–∞–ø–∏—Å–µ–π –≤ Unifi](#–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-dns-–∑–∞–ø–∏—Å–µ–π-–≤-unifi)
  - üó∫Ô∏è [–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞](#–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-—Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ-–º–∞—Ä—à—Ä—É—Ç–∞)
  - ‚úÖ [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã](#–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç—ã)
- üí° [–ü—Ä–æ—á–∞—è –ø–æ–ª–µ–∑–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è](#–ø—Ä–æ—á–∞—è-–ø–æ–ª–µ–∑–Ω–∞—è-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
  - üß© [–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ–º–µ–Ω–æ–≤ –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º](#–ø–æ–ª–Ω—ã–π-—Å–ø–∏—Å–æ–∫-–¥–æ–º–µ–Ω–æ–≤-–ø–æ-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º-—Ñ–∞–π–ª–∞–º)

---
<a id="–≤–≤–µ–¥–µ–Ω–∏–µ"></a>
## üìò –í–≤–µ–¥–µ–Ω–∏–µ
‚¨ÜÔ∏è [–∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](#–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)

–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ **Ubiquiti/Unifi**, –¥–ª—è —Ç–µ—Ö, —É –∫–æ–≥–æ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä–∞–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π **Ubiquiti**, —Ä–∞–∑–º–µ—â—ë–Ω–Ω—ã—Ö –Ω–∞ **Amazon**.

–°—É—Ç—å –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–≤–æ–¥–∏—Ç—Å—è –∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é –æ–¥–Ω–æ–π —Ü–µ–ª–∏ ‚Äî –ø–æ –Ω–∞–∂–∞—Ç–∏—é –∫–Ω–æ–ø–∫–∏ **Update** –≤—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è, –ª–∏–±–æ –≤ —Å–ª—É—á–∞–µ **Install** –∏–Ω—Å—Ç–∞–ª–ª–∏—Ä—É—é—Ç—Å—è.

---
<a id="–≤–∞—Ä–∏–∞–Ω—Ç—ã-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏"></a>
## ‚öôÔ∏è –í–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚¨ÜÔ∏è [–∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](#–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏:

1. –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è **—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Å–µ—Ç–∏**
2. –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è **–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ç–µ–π**
3. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ–µ **–ø—É–Ω–∫—Ç—É 2**, –Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **docker** (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

---
<a id="—á—Ç–æ-–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ"></a>
## üß∞ –ß—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
‚¨ÜÔ∏è [–∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](#–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)

- **–°–ø–æ—Å–æ–± 1**: –Ω—É–∂–µ–Ω —Ä–∞–±–æ—á–∏–π —Ç—É–Ω–Ω–µ–ª—å, —Å –ø—É–±–ª–∏—á–Ω—ã–º ip –∞–¥—Ä–µ—Å–æ–º, —Å—Ç—Ä–∞–Ω—ã –Ω–∞—Ö–æ–¥—è—â–∞—è—Å—è **–≤–Ω–µ –ø–æ–¥—Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ –≥–µ–æ–±–ª–æ–∫–∞**, –¥–æ –∫–æ—Ç–æ—Ä–æ–π –ø–æ–¥–Ω—è—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç—É–Ω–Ω–µ–ª—å.
> ‚ö†Ô∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**  
> –î–∞–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–¥–æ–π–¥—ë—Ç —Ç–µ–º, —É –∫–æ–≥–æ **–Ω–µ—Ç —Å–≤–æ–µ–≥–æ VPS**, –Ω–æ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ç—É–Ω–Ω–µ–ª—è.
- **–°–ø–æ—Å–æ–± 2 –∏ 2.1**: –Ω—É–∂–Ω–∞ **—Ä–∞–±–æ—á–∞—è VPS**, –Ω–∞—Ö–æ–¥—è—â–∞—è—Å—è **–≤–Ω–µ –ø–æ–¥—Å–∞–Ω–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ –≥–µ–æ–±–ª–æ–∫–∞**, –¥–æ –∫–æ—Ç–æ—Ä–æ–π –ø–æ–¥–Ω—è—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç—É–Ω–Ω–µ–ª—å, –∏ —Ç–∞–∫ –∂–µ –∫ –Ω–µ–π –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –ø–æ ssh.
> ‚ö†Ô∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**  
> –î–∞–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç, —á—Ç–æ —É –≤–∞—Å **—É–∂–µ –µ—Å—Ç—å VPS**, –∏ –∫ –Ω–µ–π –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –ø–æ **SSH**.

---
<a id="—Å–ø–æ—Å–æ–±-1--–±–µ–∑-vps-—Å-—Ç—É–Ω–Ω–µ–ª–µ–º"></a>
## üè† –°–ø–æ—Å–æ–± 1 ‚Äî –ë–µ–∑ VPS, —Å —Ç—É–Ω–Ω–µ–ª–µ–º
‚¨ÜÔ∏è [–∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](#–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)

1. –í —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Å–µ—Ç–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å **–≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É (Linux)**.
2. –ü—Ä–µ–¥–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º DNS –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ, –∫–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ [—Ç—É—Ç](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-dns).
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º nginx –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ, –∫–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ [—Ç—É—Ç](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-nginx).
4. –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é stream –¥–ª—è nginx –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ, –∫–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ [—Ç—É—Ç](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏-stream).
5. –í—ã–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª–∞ –¥–ª—è stream, –∫–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ [—Ç—É—Ç](#–≤—ã–±–æ—Ä-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ-—Ñ–∞–π–ª–∞-–¥–ª—è-stream).
6. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ç—É–Ω–Ω–µ–ª—å —á–µ—Ä–µ–∑ Policy Engine, –∫–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ [—Ç—É—Ç](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—Ç—É–Ω–Ω–µ–ª—è-—á–µ—Ä–µ–∑-policy-engine-–≤-–º–µ–Ω—é-policy-table).
7. –î–æ–±–∞–≤–ª—è–µ–º DNS –∑–∞–ø–∏—Å–∏ –≤ Unifi, –¥–ª—è –¥–æ–º–µ–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∑–∞–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å—Å—è –≤ —Ç—É–Ω–Ω–µ–ª—å [—Ç—É—Ç](#–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-dns-–∑–∞–ø–∏—Å–µ–π-–≤-unifi).
8. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É, –∫–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ [—Ç—É—Ç](#–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç—ã).

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.

---
<a id="—Å–ø–æ—Å–æ–±-2--—Å-vps"></a>
## ‚òÅÔ∏è –°–ø–æ—Å–æ–± 2 ‚Äî –° VPS
‚¨ÜÔ∏è [–∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](#–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)

> ‚ö†Ô∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**  
> –ë—É–¥–µ–º —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ —Ç—É–Ω–Ω–µ–ª—å –ø–æ–¥–Ω—è—Ç –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∞–¥—Ä–µ—Å–∞:
> - –í–∞—à IP –≤ —Ç—É–Ω–Ω–µ–ª–µ: `10.1.1.2`  
> - IP —Å–µ—Ä–≤–µ—Ä–∞ –≤ —Ç—É–Ω–Ω–µ–ª–µ: `10.1.1.1`

1. –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ VPS. –ï—Å–ª–∏ nginx –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Äî —Å—Ç–∞–≤–∏–º, –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–æ—á–µ—Ä–µ–¥–Ω–æ, –∫–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ [—Ç—É—Ç](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-dns), [—Ç—É—Ç](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-nginx) –∏ [—Ç—É—Ç](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏-stream).
2. –í—ã–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª–∞ –¥–ª—è stream, –∫–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ [—Ç—É—Ç](#–≤—ã–±–æ—Ä-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ-—Ñ–∞–π–ª–∞-–¥–ª—è-stream).
> ‚ö†Ô∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**  
> –í –ø–æ–ª–µ **IP Address** —É–∫–∞–∑—ã–≤–∞–µ–º **IP —Å–µ—Ä–≤–µ—Ä–∞** –≤ —Ç—É–Ω–Ω–µ–ª–µ
3. –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–∞—Ä—à—Ä—É—Ç –¥–æ –æ–±—Ä–∞—Ç–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã —Ç—É–Ω–Ω–µ–ª—è, –∫–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ [—Ç—É—Ç](#–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-—Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ-–º–∞—Ä—à—Ä—É—Ç–∞).
4. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É, –∫–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ [—Ç—É—Ç](#–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç—ã).

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.

---
<a id="–Ω–∞—Å—Ç—Ä–æ–π–∫–∏"></a>
## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

<a id="–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-dns"></a>
### üåç –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS
‚¨ÜÔ∏è [–∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](#–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)

–û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤:

```bash
sudo apt update
```

–ú–µ–Ω—è–µ–º DNS —Å–µ—Ä–≤–µ—Ä:

```bash
sudo echo "nameserver 9.9.9.9" > /etc/resolv.conf
```

<a id="—É—Å—Ç–∞–Ω–æ–≤–∫–∞-nginx"></a>
### üß± –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx
‚¨ÜÔ∏è [–∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](#–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º **nginx** (–ª–∏–±–æ **haproxy**, **traefik**, –ø—Ä–∏–º–µ—Ä –ø—Ä–∏–≤–µ–¥—ë–Ω –Ω–∞ nginx –∏ Debian):

```bash
sudo apt install nginx -y
```

–ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –º–æ–¥—É–ª—è **ngx_stream_module**:

```bash
sudo nginx -V 2>&1 | grep --color stream
```

–ï—Å–ª–∏ –≤ –≤—ã–≤–æ–¥–µ –µ—Å—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:

```
--with-stream=dynamic
```

–∏–ª–∏

```
--with-stream
```

–∑–Ω–∞—á–∏—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∞ stream –µ—Å—Ç—å.

–ï—Å–ª–∏ –º–æ–¥—É–ª—å **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π** (`--with-stream=dynamic`), –µ–≥–æ –Ω—É–∂–Ω–æ —è–≤–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ:

```bash
sudo nano /etc/nginx/nginx.conf
```

–î–æ–±–∞–≤–ª—è–µ–º (–≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ, –¥–æ –±–ª–æ–∫–∞ `events`):

```nginx
load_module modules/ngx_stream_module.so;
```

–°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º Nginx:

```bash
sudo systemctl restart nginx
```

<a id="–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏-stream"></a>
### üîß –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ stream
‚¨ÜÔ∏è [–∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](#–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)

–°–æ–∑–¥–∞—ë–º –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥–æ–≤ stream:

```bash
sudo mkdir /etc/nginx/stream.d || true
```

–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º `nginx.conf` –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ:

```bash
sudo nano /etc/nginx/nginx.conf
```

–î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É:

```nginx
include /etc/nginx/stream.d/*.conf;
```

<a id="–≤—ã–±–æ—Ä-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ-—Ñ–∞–π–ª–∞-–¥–ª—è-stream"></a>
### üìÇ –í—ã–±–æ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–ª—è stream
‚¨ÜÔ∏è [–∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](#–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)

–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏:

1. `conf/nginx/stream.d/stream-ubnt.conf` ‚Äî —Å—Ç—Ä–∏–º **—Ç–æ–ª—å–∫–æ fw-download.ubnt.com** –∏ **fw-download.ui.com**  
2. `conf/nginx/stream.d/stream-ubnt-only-dl.conf` ‚Äî —Å—Ç—Ä–∏–º –∫–∞–∫ –≤ –ø—É–Ω–∫—Ç–µ 1 + **beta**, **early access**, **release candidate**  
3. `conf/nginx/stream.d/stream-all.conf` ‚Äî —Å—Ç—Ä–∏–º –≤—Å–µ–≥–æ, –≤–∫–ª—é—á–∞—è **fw-update.ubnt.com** –∏ **fw-update.ui.com** (–¥–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ü—Ä–∏–º–µ—Ä –ø—Ä–∏–≤–µ–¥—ë–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ **–ø–µ—Ä–≤–æ–≥–æ —Å–ø–æ—Å–æ–±–∞** ‚Äî `conf/nginx/stream.d/stream-ubnt.conf`.

–ö–æ–ø–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥ stream:

```bash
sudo cp conf/nginx/stream.d/stream-ubnt.conf /etc/nginx/stream.d/
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º Nginx:

```bash
sudo systemctl restart nginx
```

---
<a id="–Ω–∞—Å—Ç—Ä–æ–π–∫–∏-–≤-network-application"></a>
## üñ•Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Network Application

<a id="–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—Ç—É–Ω–Ω–µ–ª—è-—á–µ—Ä–µ–∑-policy-engine-–≤-–º–µ–Ω—é-policy-table"></a>
### üõ∞Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—É–Ω–Ω–µ–ª—è —á–µ—Ä–µ–∑ Policy Engine –≤ –º–µ–Ω—é Policy Table
‚¨ÜÔ∏è [–∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](#–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)

–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –∑–∞–≤–µ—Ä–Ω—É—Ç—å —Ç—Ä–∞—Ñ–∏–∫ —Å —Å–æ–∑–¥–∞–Ω–Ω–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –≤ —Ç—É–Ω–Ω–µ–ª—å.

–í **Network Application** –ø–µ—Ä–µ—Ö–æ–¥–∏–º:  
**Settings ‚Üí Policy Table ‚Üí Create Net Policy ‚Üí Route**

–í –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –≤—ã–±–∏—Ä–∞–µ–º:

- **Type policy**: `Route`  
- **Name**: –ª—é–±–æ–µ –æ—Å–º—ã—Å–ª–µ–Ω–Ω–æ–µ –∏–º—è  
- **Type**: `Policy-Based`  
- **Interface/VPN Tunnel**: –∏–º—è —Ç—É–Ω–Ω–µ–ª—è –¥–æ VPS  
- **Source**: `Device/Network` ‚Üí –≤—ã–±–∏—Ä–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É (–ø–æ IP –∏–ª–∏ –¥—Ä—É–≥–æ–º—É –ø–∞—Ä–∞–º–µ—Ç—Ä—É)  
- **Destination**: `Any`

–ù–∞–∂–∏–º–∞–µ–º **Add** ‚Äî –≥–æ—Ç–æ–≤–æ.

![–ü—Ä–∏–º–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è](img/create-policy-pbr.png)

<a id="–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-dns-–∑–∞–ø–∏—Å–µ–π-–≤-unifi"></a>
### üßæ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ DNS –∑–∞–ø–∏—Å–µ–π –≤ Unifi
‚¨ÜÔ∏è [–∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](#–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)

–í **Network Application** –Ω–∞–∂–∏–º–∞–µ–º:  
**Settings ‚Üí Policy Table ‚Üí Create Net Policy ‚Üí DNS**

–í –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –≤—ã–±–∏—Ä–∞–µ–º:
- **Type** = `Host (A)`  
- **Domain Name** = `fw-download.ubnt.com`  
- **IP Address** = –ª–æ–∫–∞–ª—å–Ω—ã–π IP –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã

–ñ–º—ë–º **Add** ‚Äî –≥–æ—Ç–æ–≤–æ.

![–ü—Ä–∏–º–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è](img/create-policy-dns.png)

–ü–æ–≤—Ç–æ—Ä—è–µ–º —Ç–æ –∂–µ —Å–∞–º–æ–µ –∏ –¥–ª—è –¥–æ–º–µ–Ω–∞ `fw-download.ui.com`.

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥—Ä—É–≥–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã nginx (`stream-ubnt-all.conf` –∏–ª–∏ `stream-ubnt-only-dl.conf`), –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤, –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –≤ –∫–æ–Ω—Ñ–∏–≥–µ.

<a id="–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-—Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ-–º–∞—Ä—à—Ä—É—Ç–∞"></a>
### üó∫Ô∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
‚¨ÜÔ∏è [–∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](#–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)

–ò–Ω–æ–≥–¥–∞ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –¥–æ–±–∞–≤–∏—Ç—å **static route** –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã —Ç—É–Ω–Ω–µ–ª—è.

–í **Network Application** –ø–µ—Ä–µ—Ö–æ–¥–∏–º:  
**Settings ‚Üí Policy Table ‚Üí Create Net Policy ‚Üí Route**

–í –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –≤—ã–±–∏—Ä–∞–µ–º:
- **Type policy**: `Route`  
- **Name**: –ª—é–±–æ–µ –æ—Å–º—ã—Å–ª–µ–Ω–Ω–æ–µ  
- **Type**: `Static`  
- **Interface/VPN Tunnel**: –∏–º—è —Ç—É–Ω–Ω–µ–ª—è –¥–æ VPS  
- **Device**: `Gateway`  
- **Distance**: `1`  
- **Interface**: –≤—ã–±–∏—Ä–∞–µ–º –∏–º—è —Ç—É–Ω–Ω–µ–ª—è

–ñ–º—ë–º **Add** ‚Äî –≥–æ—Ç–æ–≤–æ.

![–ü—Ä–∏–º–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è](img/create-policy-static-route.png)

<a id="–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç—ã"></a>
### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
‚¨ÜÔ∏è [–∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](#–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–¥—ë–º:  
**Settings ‚Üí Control Plane ‚Üí Updates**  
–ü—Ä–æ–±—É–µ–º –æ–±–Ω–æ–≤–∏—Ç—å—Å—è, –ª–∏–±–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã.

---
<a id="–ø—Ä–æ—á–∞—è-–ø–æ–ª–µ–∑–Ω–∞—è-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"></a>
## üí° –ü—Ä–æ—á–∞—è –ø–æ–ª–µ–∑–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

<a id="–ø–æ–ª–Ω—ã–π-—Å–ø–∏—Å–æ–∫-–¥–æ–º–µ–Ω–æ–≤-–ø–æ-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º-—Ñ–∞–π–ª–∞–º"></a>
### üß© –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ–º–µ–Ω–æ–≤ –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º
‚¨ÜÔ∏è [–∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](#–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)

### `conf/nginx/stream.d/stream-ubnt.conf`
- fw-download.ubnt.com  
- fw-download.ui.com  

### `conf/nginx/stream.d/stream-ubnt-only-dl.conf`
- fw-download.ubnt.com  
- fw-download.ui.com  
- apt.artifacts.ui.com  
- apt-release-candidate.artifacts.ui.com  
- apt-beta.artifacts.ui.com  

### `conf/nginx/stream.d/stream-all.conf`
- fw-download.ubnt.com  
- fw-download.ui.com  
- fw-update.ubnt.com  
- fw-update.ui.com  
- apt.artifacts.ui.com  
- apt-release-candidate.artifacts.ui.com  
- apt-beta.artifacts.ui.com  

> ‚ö†Ô∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**  
> –ó–∞–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –¥–æ–º–µ–Ω—ã `fw-update.ubnt.com` –∏ `fw-update.ui.com` –≤ —Å—Ç—Ä–∏–º **–Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞** ‚Äî —ç—Ç–∏ –¥–æ–º–µ–Ω—ã –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã, –∏ **Network Application** –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–µ–¥–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é.
